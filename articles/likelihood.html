<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Likelihood Profile • ss3diags</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Likelihood Profile">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ss3diags</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/aspm.html">ASPM</a></li>
    <li><a class="dropdown-item" href="../articles/hcxval.html">Hindcast Cross-Validation</a></li>
    <li><a class="dropdown-item" href="../articles/Jitter.html">Jitter Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/likelihood.html">Likelihood Profile</a></li>
    <li><a class="dropdown-item" href="../articles/residuals.html">Residual Analyses</a></li>
    <li><a class="dropdown-item" href="../articles/Retrospective-Analysis.html">Retrospective Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/PIFSCstockassessments/ss3diags/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Likelihood Profile</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PIFSCstockassessments/ss3diags/blob/main/vignettes/articles/likelihood.Rmd" class="external-link"><code>vignettes/articles/likelihood.Rmd</code></a></small>
      <div class="d-none name"><code>likelihood.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PIFSCstockassessments/ss3diags" class="external-link">ss3diags</a></span><span class="op">)</span></span></code></pre></div>
<p>Likelihood profiling is a key model diagnostic that helps identify
the influence of information sources on model estimates. The number of
recruits in an unfished population (R<sub>0</sub>) is a commonly
profiled parameter since it dictates the absolute size of a fish
population (serves as global scaling parameter). To conduct a profile,
values of the parameter over a given range are fixed and the model
re-run and then changes in total likelihood and data-component
likelihoods are examined. It is recommended to run this throughout the
development process, particularly after incorporating new data sets to
understand how informative each component is on the estimation of R0 and
if there is conflict between data sources.</p>
<div class="section level2">
<h2 id="model-inputs">Model inputs<a class="anchor" aria-label="anchor" href="#model-inputs"></a>
</h2>
<p>To run a Stock Synthesis model, four input files are required:
starter.ss, forecast.ss, control.ss, and data.ss. The input files for
the example model can be found within the <code>ss3diags</code> package
and accessed as shown below. Also, if you do not have the
<code>r4ss</code> package installed, you will need to install it for
this tutorial.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pak"</span><span class="op">)</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"r4ss/r4ss"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r4ss/r4ss" class="external-link">r4ss</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">files_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"ss3diags"</span><span class="op">)</span></span>
<span><span class="va">dir_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span>check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dir_profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_tmp</span>, <span class="st">"profile"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">dir_profile</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">files_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "control.ss"  "data.ss"     "forecast.ss" "starter.ss"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">files_path</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, to <span class="op">=</span> <span class="va">dir_tmp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE TRUE TRUE TRUE</span></span></code></pre></div>
<p>You will need to make sure you have the <a href="https://github.com/nmfs-stock-synthesis/stock-synthesis" class="external-link">SS
executable</a> file either in your path or in the directory you are
running the profile from (in this case <code>dir_profile</code>). An
easy way to get the latest release of stock synthesis is to use the
<code>r4ss</code> function <code><a href="../reference/get_ss3_exe.html">get_ss3_exe()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/get_ss3_exe.html" class="external-link">get_ss3_exe</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">dir_tmp</span>, version <span class="op">=</span> <span class="st">"v3.30.21"</span><span class="op">)</span></span>
<span><span class="co">#&gt; The stock synthesis executable for Linux v3.30.21 was downloaded to: /tmp/RtmpNzlZPd/ss3</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-a-profile-on-r0">Running a Profile on R<sub>0</sub><a class="anchor" aria-label="anchor" href="#running-a-profile-on-r0"></a>
</h2>
<p>Once you have the four input files and SS executable file, you can
run a likelihood profile as shown below. The first step is to run the
model you would like to do a profile for. We will do this in
<code>dir_tmp</code> and then copy the necessary files to
<code>dir_profile</code>. It’s best to run the profile in a subdirectory
of your main model run to keep the output files separate from other
diagnostic tests you may run.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/run.html" class="external-link">run</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">dir_tmp</span>, exe <span class="op">=</span> <span class="st">"ss3"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ran model" "ran model" "ran model" "ran model" "ran model"</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data.ss"</span>, <span class="st">"control.ss_new"</span>, <span class="st">"starter.ss"</span>, <span class="st">"forecast.ss"</span>, <span class="st">"ss.par"</span>, <span class="st">"ss3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_tmp</span>, <span class="va">files</span><span class="op">)</span>, to <span class="op">=</span> <span class="va">dir_profile</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE TRUE TRUE TRUE TRUE TRUE</span></span></code></pre></div>
<p>Once you have the input files in the <code>dir_profile</code>
directory, you will need to create a vector of values to profile across.
The range and increments to choose depend on your model and the
resolution at which you want to analyze the likelihood profile. For this
example we will use a fairly coarse resolution to speed up total run
time.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CTL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_readctl_3.30.html" class="external-link">SS_readctl_3.30</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_profile</span>, <span class="st">"control.ss_new"</span><span class="op">)</span>, datlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_profile</span>, <span class="st">"data.ss"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CTL</span><span class="op">$</span><span class="va">SR_parms</span></span>
<span><span class="co">#&gt;               LO HI   INIT PRIOR PR_SD PR_type PHASE env_var&amp;link dev_link</span></span>
<span><span class="co">#&gt; SR_LN(R0)    6.0 12 8.9274  10.3  10.0       0     1            0        0</span></span>
<span><span class="co">#&gt; SR_BH_steep  0.2  1 0.8000   0.8   1.0       0    -4            0        0</span></span>
<span><span class="co">#&gt; SR_sigmaR    0.0  2 0.6000   0.8   0.8       0    -4            0        0</span></span>
<span><span class="co">#&gt; SR_regime   -5.0  5 0.0000   0.0   1.0       0    -4            0        0</span></span>
<span><span class="co">#&gt; SR_autocorr  0.0  0 0.0000   0.0   0.0       0   -99            0        0</span></span>
<span><span class="co">#&gt;             dev_minyr dev_maxyr dev_PH Block Block_Fxn</span></span>
<span><span class="co">#&gt; SR_LN(R0)           0         0      0     0         0</span></span>
<span><span class="co">#&gt; SR_BH_steep         0         0      0     0         0</span></span>
<span><span class="co">#&gt; SR_sigmaR           0         0      0     0         0</span></span>
<span><span class="co">#&gt; SR_regime           0         0      0     0         0</span></span>
<span><span class="co">#&gt; SR_autocorr         0         0      0     0         0</span></span>
<span><span class="co"># getting the estimated r0 value</span></span>
<span><span class="va">r0</span> <span class="op">&lt;-</span> <span class="va">CTL</span><span class="op">$</span><span class="va">SR_parms</span><span class="op">$</span><span class="va">INIT</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># creating a vector that is +/- 1 unit away from the estimated value in increments of 0.2</span></span>
<span><span class="va">r0_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">r0</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">r0</span> <span class="op">+</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">r0_vec</span></span>
<span><span class="co">#&gt;  [1] 7.9274 8.1274 8.3274 8.5274 8.7274 8.9274 9.1274 9.3274 9.5274 9.7274</span></span>
<span><span class="co">#&gt; [11] 9.9274</span></span></code></pre></div>
<p>We also need to modify the starter file by changing the name of the
control file that it will read from and making sure the likelihood is
calculated for non-estimated quantities.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">START</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_readstarter.html" class="external-link">SS_readstarter</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_profile</span>, <span class="st">"starter.ss"</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">START</span><span class="op">$</span><span class="va">prior_like</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">START</span><span class="op">$</span><span class="va">ctlfile</span> <span class="op">&lt;-</span> <span class="st">"control_modified.ss"</span></span>
<span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_writestarter.html" class="external-link">SS_writestarter</a></span><span class="op">(</span><span class="va">START</span>, dir <span class="op">=</span> <span class="va">dir_profile</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>To run the profile, use <code><a href="https://r4ss.github.io/r4ss/reference/profile.html" class="external-link">r4ss::profile()</a></code> and you will
need to specify a partial string of the name of the parameter you are
profiling over (in this case “SR_LN” will match with “SR_LN(R0)”), and
the vector of values to profile across. The <code>newctlfile</code> is
the control file that will be adjusted with values from the
<code>profilevec</code> and can be named anything you prefer, it just
needs to match what you put in the starter file for “ctlfile”. Full
documentation of the <code><a href="https://r4ss.github.io/r4ss/reference/profile.html" class="external-link">profile()</a></code> function can be found on the
<a href="https://r4ss.github.io/r4ss/reference/profile.html" class="external-link">r4ss
website</a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/profile.html" class="external-link">profile</a></span><span class="op">(</span></span>
<span>  dir <span class="op">=</span> <span class="va">dir_profile</span>,</span>
<span>  newctlfile <span class="op">=</span> <span class="st">"control_modified.ss"</span>,</span>
<span>  string <span class="op">=</span> <span class="st">"SR_LN"</span>,</span>
<span>  profilevec <span class="op">=</span> <span class="va">r0_vec</span>,</span>
<span>  exe <span class="op">=</span> <span class="st">"ss3"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; running profile i=1/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  7.9274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt; running profile i=2/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  8.1274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt; running profile i=3/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  8.3274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt; running profile i=4/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  8.5274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt; running profile i=5/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  8.7274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt; running profile i=6/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  8.9274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt; running profile i=7/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  9.1274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt; running profile i=8/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  9.3274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt; running profile i=9/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  9.5274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt; running profile i=10/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  9.7274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt; running profile i=11/11</span></span>
<span><span class="co">#&gt; Parameter names in control file matching input vector </span></span>
<span><span class="co">#&gt; 'strings' (n=1): SR_LN(R0)</span></span>
<span><span class="co">#&gt; line numbers in control file (n=1): 120</span></span>
<span><span class="co">#&gt; Wrote new file to control_modified.ss with the following changes:</span></span>
<span><span class="co">#&gt;   oldvals newvals oldphase newphase oldlos newlos oldhis newhis oldprior</span></span>
<span><span class="co">#&gt; 1  8.9274  9.9274        1       -1      6      6     12     12     10.3</span></span>
<span><span class="co">#&gt;   newprior oldprsd newprsd oldprtype newprtype     comment</span></span>
<span><span class="co">#&gt; 1     10.3      10      10         0         0 # SR_LN(R0)</span></span>
<span><span class="co">#&gt;     Value converged    TOTAL       Catch Equil_catch    Survey Length_comp</span></span>
<span><span class="co">#&gt; 1  7.9274      TRUE 1067.570 4.40715e-01   16.620400  6.065520     453.198</span></span>
<span><span class="co">#&gt; 2  8.1274      TRUE  937.149 1.46579e+00   13.928400  1.888540     417.316</span></span>
<span><span class="co">#&gt; 3  8.3274      TRUE  844.325 4.84432e-01    9.292590 -2.134720     393.233</span></span>
<span><span class="co">#&gt; 4  8.5274      TRUE  790.513 9.17170e-06    3.930790 -5.726270     379.721</span></span>
<span><span class="co">#&gt; 5  8.7274      TRUE  762.562 6.48949e-08    0.271032 -7.140910     370.420</span></span>
<span><span class="co">#&gt; 6  8.9274      TRUE  754.302 1.33458e-10    0.174869 -7.118110     366.756</span></span>
<span><span class="co">#&gt; 7  9.1274      TRUE  758.927 2.10816e-13    1.337060 -6.106700     367.497</span></span>
<span><span class="co">#&gt; 8  9.3274      TRUE  767.708 1.90347e-13    3.424990 -4.917570     369.543</span></span>
<span><span class="co">#&gt; 9  9.5274      TRUE  777.243 1.15331e-13    6.433440 -3.857200     371.605</span></span>
<span><span class="co">#&gt; 10 9.7274      TRUE  787.189 6.73658e-14   10.382600 -2.563580     373.376</span></span>
<span><span class="co">#&gt; 11 9.9274      TRUE  798.152 4.05051e-14   15.279300 -0.380772     374.815</span></span>
<span><span class="co">#&gt;    Age_comp Size_at_age Recruitment InitEQ_Regime Forecast_Recruitment</span></span>
<span><span class="co">#&gt; 1   341.340     230.715   19.181500   0.00000e+00                    0</span></span>
<span><span class="co">#&gt; 2   289.737     199.683   13.121200   0.00000e+00                    0</span></span>
<span><span class="co">#&gt; 3   258.805     179.372    5.270210   0.00000e+00                    0</span></span>
<span><span class="co">#&gt; 4   243.456     167.416    1.713560   1.54502e-30                    0</span></span>
<span><span class="co">#&gt; 5   234.970     163.525    0.515980   1.54502e-30                    0</span></span>
<span><span class="co">#&gt; 6   231.845     162.399    0.244060   1.54502e-30                    0</span></span>
<span><span class="co">#&gt; 7   233.210     162.675    0.312441   0.00000e+00                    0</span></span>
<span><span class="co">#&gt; 8   235.957     163.170    0.529082   0.00000e+00                    0</span></span>
<span><span class="co">#&gt; 9   238.622     163.598    0.839498   1.54502e-30                    0</span></span>
<span><span class="co">#&gt; 10  240.872     163.942    1.178030   0.00000e+00                    0</span></span>
<span><span class="co">#&gt; 11  242.718     164.208    1.510550   0.00000e+00                    0</span></span>
<span><span class="co">#&gt;    Parm_priors Parm_softbounds Parm_devs Crash_Pen    max_grad</span></span>
<span><span class="co">#&gt; 1            0      0.00756177         0         0 1.53717e-05</span></span>
<span><span class="co">#&gt; 2            0      0.00997359         0         0 4.45599e-05</span></span>
<span><span class="co">#&gt; 3            0      0.00312060         0         0 6.84977e-06</span></span>
<span><span class="co">#&gt; 4            0      0.00197985         0         0 2.05016e-05</span></span>
<span><span class="co">#&gt; 5            0      0.00143663         0         0 5.99653e-06</span></span>
<span><span class="co">#&gt; 6            0      0.00141332         0         0 1.69256e-05</span></span>
<span><span class="co">#&gt; 7            0      0.00150262         0         0 4.91877e-06</span></span>
<span><span class="co">#&gt; 8            0      0.00159065         0         0 7.52242e-06</span></span>
<span><span class="co">#&gt; 9            0      0.00166199         0         0 1.63161e-05</span></span>
<span><span class="co">#&gt; 10           0      0.00171844         0         0 1.71582e-07</span></span>
<span><span class="co">#&gt; 11           0      0.00176282         0         0 2.46224e-05</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizing-output">Visualizing Output<a class="anchor" aria-label="anchor" href="#visualizing-output"></a>
</h2>
<p>Once the profile is finished running, we can visualize the results to
determine if there is conflict between the data sources. If all data
sources reach a negative log-likelihood (NLL) minimum at the same
R<sub>0</sub> value, this indicates good agreement between them.
However, more likely, one or more will reach this NLL minimum at
different R0 values from the global R<sub>0</sub> value. This is a sign
of conflict between your data sources and may require you to consider
data weighting.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profile_mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SSgetoutput.html" class="external-link">SSgetoutput</a></span><span class="op">(</span>dirvec <span class="op">=</span> <span class="va">dir_profile</span>, keyvec <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r0_vec</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="co">#&gt; Warning in SS_output(dir = mydir, repfile = repFileName, covarfile = covarname, : 32 estimated parameters indicated by the par file</span></span>
<span><span class="co">#&gt;   31 estimated parameters shown in the covar file</span></span>
<span><span class="co">#&gt;   Returning the par file value: 32</span></span>
<span><span class="va">profile_mods_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SSsummarize.html" class="external-link">SSsummarize</a></span><span class="op">(</span><span class="va">profile_mods</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SSplotProfile.html" class="external-link">SSplotProfile</a></span><span class="op">(</span><span class="va">profile_mods_sum</span>,</span>
<span>  profile.string <span class="op">=</span> <span class="st">"SR_LN"</span>,</span>
<span>  profile.label <span class="op">=</span> <span class="st">"SR_LN(R0)"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter matching profile.string=SR_LN: SR_LN(R0)</span></span>
<span><span class="co">#&gt; Parameter values (after subsetting based on input 'models'): 7.9274, 8.1274, 8.3274, 8.5274, 8.7274, 8.9274, 9.1274, 9.3274, 9.5274, 9.7274, 9.9274</span></span>
<span><span class="co">#&gt; Likelihood components showing max change as fraction of total change.</span></span>
<span><span class="co">#&gt; To change which components are included, change input 'minfraction'.</span></span>
<span><span class="co">#&gt;                      frac_change include                            label</span></span>
<span><span class="co">#&gt; TOTAL                     1.0000    TRUE                            Total</span></span>
<span><span class="co">#&gt; Catch                     0.0047   FALSE                            Catch</span></span>
<span><span class="co">#&gt; Equil_catch               0.0525    TRUE                Equilibrium catch</span></span>
<span><span class="co">#&gt; Survey                    0.0422    TRUE                       Index data</span></span>
<span><span class="co">#&gt; Length_comp               0.2759    TRUE                      Length data</span></span>
<span><span class="co">#&gt; Age_comp                  0.3495    TRUE                         Age data</span></span>
<span><span class="co">#&gt; Size_at_age               0.2181    TRUE                 Size-at-age data</span></span>
<span><span class="co">#&gt; Recruitment               0.0605    TRUE                      Recruitment</span></span>
<span><span class="co">#&gt; InitEQ_Regime             0.0000   FALSE Initital equilibrium recruitment</span></span>
<span><span class="co">#&gt; Forecast_Recruitment      0.0000   FALSE             Forecast recruitment</span></span>
<span><span class="co">#&gt; Parm_priors               0.0000   FALSE                           Priors</span></span>
<span><span class="co">#&gt; Parm_softbounds           0.0000   FALSE                      Soft bounds</span></span>
<span><span class="co">#&gt; Parm_devs                 0.0000   FALSE             Parameter deviations</span></span>
<span><span class="co">#&gt; Crash_Pen                 0.0000   FALSE                    Crash penalty</span></span></code></pre></div>
<p><img src="likelihood_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>The profile plot above shows the changes in log-likelihood across the
selected range of values for each of the contributing data components.
There is an adjustable minimum contribution threshold that a component
must meet to appear in this figure (if there is a data source that is in
your model but does not show up in the plot, its contribution to the
total likelihood may not be large enough). The steepness of each
trajectory indicates how informative (or not) a data source is. For
example, the age data in the plot above is much steeper on the left side
of the minimum R0 value than the index data, which suggests that age
composition data is more informative in the model.</p>
<p>You can also plot data-type and fleet-specific profiles using
<code><a href="https://r4ss.github.io/r4ss/reference/PinerPlot.html" class="external-link">r4ss::PinerPlot()</a></code>. Below we are plotting the profile for
the length composition data by fleet and the likelihood of survey data
by fleet. This will allow us to see if there are conflicts and what
sources are the main drivers.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/sspar.html" class="external-link">sspar</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/PinerPlot.html" class="external-link">PinerPlot</a></span><span class="op">(</span><span class="va">profile_mods_sum</span>,</span>
<span>  component <span class="op">=</span> <span class="st">"Length_like"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Length"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter matching profile.string = 'R0': 'SR_LN(R0)</span></span>
<span><span class="co">#&gt; Parameter values (after subsetting based on input 'models'): 7.9274, 8.1274, 8.3274, 8.5274, 8.7274, 8.9274, 9.1274, 9.3274, 9.5274, 9.7274, 9.9274,</span></span>
<span><span class="co">#&gt; Fleet-specific likelihoods showing max change as fraction of total change.</span></span>
<span><span class="co">#&gt; To change which components are included, change input 'minfraction'.</span></span>
<span><span class="co">#&gt;         frac_change include</span></span>
<span><span class="co">#&gt; FISHERY      0.6825    TRUE</span></span>
<span><span class="co">#&gt; SURVEY1      0.3208    TRUE</span></span>
<span><span class="co">#&gt; SURVEY2      0.0000   FALSE</span></span>
<span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/PinerPlot.html" class="external-link">PinerPlot</a></span><span class="op">(</span><span class="va">profile_mods_sum</span>,</span>
<span>  component <span class="op">=</span> <span class="st">"Surv_like"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Survey"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter matching profile.string = 'R0': 'SR_LN(R0)</span></span>
<span><span class="co">#&gt; Parameter values (after subsetting based on input 'models'): 7.9274, 8.1274, 8.3274, 8.5274, 8.7274, 8.9274, 9.1274, 9.3274, 9.5274, 9.7274, 9.9274,</span></span>
<span><span class="co">#&gt; Fleet-specific likelihoods showing max change as fraction of total change.</span></span>
<span><span class="co">#&gt; To change which components are included, change input 'minfraction'.</span></span>
<span><span class="co">#&gt;         frac_change include</span></span>
<span><span class="co">#&gt; FISHERY      0.0000   FALSE</span></span>
<span><span class="co">#&gt; SURVEY1      0.3218    TRUE</span></span>
<span><span class="co">#&gt; SURVEY2      0.9202    TRUE</span></span></code></pre></div>
<p><img src="likelihood_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Henning Winker, Felipe Carvalho, Massimiliano Cardinale, Laurence Kell, Megumi Oshima, Eric Fletcher.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
