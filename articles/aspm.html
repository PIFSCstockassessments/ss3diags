<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ss3diags">
<title>ASPM • ss3diags</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ASPM">
<meta property="og:description" content="ss3diags">
<meta property="og:image" content="https://pifscstockassessments.github.io/ss3diags/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ss3diags</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Jitter.html">Jitter Analysis</a>
    <a class="dropdown-item" href="../articles/Retrospective-Analysis.html">Retrospective Analysis</a>
    <a class="dropdown-item" href="../articles/aspm.html">ASPM</a>
    <a class="dropdown-item" href="../articles/hcxval.html">Hindcast Cross-Validation</a>
    <a class="dropdown-item" href="../articles/likelihood.html">Likelihood Profile</a>
    <a class="dropdown-item" href="../articles/residuals.html">Residual Analyses</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/PIFSCstockassessments/ss3diags/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>ASPM</h1>
            
            <h4 data-toc-skip class="date">2023-08-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/PIFSCstockassessments/ss3diags/blob/HEAD/vignettes/articles/aspm.Rmd" class="external-link"><code>vignettes/articles/aspm.Rmd</code></a></small>
      <div class="d-none name"><code>aspm.Rmd</code></div>
    </div>

    
    
<p>The application of the Age-Structured Production Model (ASPM)
approach as a diagnostic can help identify misspecification of the
production function. If, in the absence of composition data (likelihood
weighting set to 0), the ASPM fits well to the indices of abundance that
have good contrast, then the production function is likely to drive the
stock dynamics and indices will provide information about the absolute
abundance (<a href="https://www.sciencedirect.com/science/article/pii/S0165783616303113" class="external-link">Carvalho
et al. 2017</a>). If there is not a good fit to the indices, then the
catch data and production function alone cannot explain the trajectories
of the indices of relative abundance.</p>
<div class="section level2">
<h2 id="model-inputs">Model inputs<a class="anchor" aria-label="anchor" href="#model-inputs"></a>
</h2>
<p>To run a stock synthesis model, 4 input files are required: starter,
forecast, control, and data. The input files for the example model can
be found within the <code>ss3diags</code> package and accessed as shown
below. Also, if you do not have <code>r4ss</code> installed, you will
need to install for this tutorial.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pak"</span><span class="op">)</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"r4ss/r4ss"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r4ss/r4ss" class="external-link">r4ss</a></span><span class="op">)</span> </span>
<span></span>
<span><span class="va">files_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"ss3diags"</span><span class="op">)</span></span>
<span><span class="va">dir_tmp</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span>check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dir_aspm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_tmp</span>, <span class="st">"aspm"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">dir_aspm</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">files_path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "control.ss"  "data.ss"     "forecast.ss" "starter.ss"</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">files_path</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, to <span class="op">=</span> <span class="va">dir_tmp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE TRUE TRUE TRUE</span></span></code></pre>
<p>You will need to make sure you have the <a href="https://github.com/nmfs-stock-synthesis/stock-synthesis" class="external-link">SS
executable</a> file either in your path or in the directory you are
running the ASPM from (in this case <code>dir_aspm</code>). An easy way
to get the latest release of stock synthesis is to use the
<code>r4ss</code> function <code><a href="https://r4ss.github.io/r4ss/reference/get_ss3_exe.html" class="external-link">get_ss3_exe()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/get_ss3_exe.html" class="external-link">get_ss3_exe</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">dir_tmp</span>, version <span class="op">=</span> <span class="st">"v3.30.21"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The stock synthesis executable for Linux v3.30.21 was downloaded to: /tmp/RtmpW6yFM8/ss3</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="aspm">ASPM<a class="anchor" aria-label="anchor" href="#aspm"></a>
</h2>
<p>Once you have the 4 input files, you need to determine what
components need to be turned off to run the ASPM. ASPM only depend on
index of abundance and catch data, so any composition data, recruitment
deviations, etc. need to be turned off. We provide an example that
includes multiple types of data and recruitment deviations, however, the
exact steps necessary for an individual model may vary depending on the
complexity and components included. Therefore these steps may not be
fully comprehensive for your model so be sure check what other
components you may need to change.<br>
Below, we show how to use the <code>r4ss</code> functions to make all
the necessary changes to the <code>control.ss</code> and
<code>ss.par</code> files.</p>
<div class="section level3">
<h3 id="generate-files">Generate files<a class="anchor" aria-label="anchor" href="#generate-files"></a>
</h3>
<p>In order to get the <code>ss.par</code> file, you need to run the
model once. This will also produce a new data and control file that we
will use as the input files. We will run the model in
<code>dir_tmp</code> then copy the new files over to
<code>dir_aspm</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/run.html" class="external-link">run</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">dir_tmp</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, exe <span class="op">=</span> <span class="st">"ss3"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "ran model"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data_echo.ss_new"</span>, <span class="st">"control.ss_new"</span>, <span class="st">"starter.ss"</span>, <span class="st">"forecast.ss"</span>, <span class="st">"ss.par"</span>, <span class="st">"ss3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_tmp</span>, <span class="va">files</span><span class="op">)</span>, to <span class="op">=</span> <span class="va">dir_aspm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE TRUE TRUE TRUE TRUE TRUE</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="recruitment-deviations">Recruitment Deviations<a class="anchor" aria-label="anchor" href="#recruitment-deviations"></a>
</h3>
<p>Set the recruitment devations in <code>ss.par</code> to 0.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_readpar_3.30.html" class="external-link">SS_readpar_3.30</a></span><span class="op">(</span>parfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_aspm</span>, <span class="st">"ss.par"</span><span class="op">)</span>, </span>
<span>                       datsource <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_aspm</span>, <span class="st">"data_echo.ss_new"</span><span class="op">)</span>,</span>
<span>                       ctlsource <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_aspm</span>, <span class="st">"control.ss_new"</span><span class="op">)</span>,</span>
<span>                       verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">par</span><span class="op">$</span><span class="va">recdev1</span></span></code></pre></div>
<pre><code><span><span class="co">##       year      recdev</span></span>
<span><span class="co">##  [1,] 2011 -0.06005247</span></span>
<span><span class="co">##  [2,] 2012 -0.01284866</span></span>
<span><span class="co">##  [3,] 2013  0.13478706</span></span>
<span><span class="co">##  [4,] 2014  0.11410144</span></span>
<span><span class="co">##  [5,] 2015 -0.08325396</span></span>
<span><span class="co">##  [6,] 2016  0.14556845</span></span>
<span><span class="co">##  [7,] 2017 -0.12973978</span></span>
<span><span class="co">##  [8,] 2018 -0.18308123</span></span>
<span><span class="co">##  [9,] 2019  0.02442762</span></span>
<span><span class="co">## [10,] 2020 -0.08979813</span></span>
<span><span class="co">## [11,] 2021 -0.07812317</span></span>
<span><span class="co">## [12,] 2022  0.21801284</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par</span><span class="op">$</span><span class="va">recdev_forecast</span></span></code></pre></div>
<pre><code><span><span class="co">##       year recdev</span></span>
<span><span class="co">##  [1,] 2023      0</span></span>
<span><span class="co">##  [2,] 2024      0</span></span>
<span><span class="co">##  [3,] 2025      0</span></span>
<span><span class="co">##  [4,] 2026      0</span></span>
<span><span class="co">##  [5,] 2027      0</span></span>
<span><span class="co">##  [6,] 2028      0</span></span>
<span><span class="co">##  [7,] 2029      0</span></span>
<span><span class="co">##  [8,] 2030      0</span></span>
<span><span class="co">##  [9,] 2031      0</span></span>
<span><span class="co">## [10,] 2032      0</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par</span><span class="op">$</span><span class="va">recdev1</span><span class="op">[</span>,<span class="st">"recdev"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co">#Would run if forecasts recdevs were not already 0</span></span>
<span><span class="co">#par$recdev_forecast[,"recdev"] &lt;- 0</span></span>
<span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_writepar_3.30.html" class="external-link">SS_writepar_3.30</a></span><span class="op">(</span>parlist <span class="op">=</span> <span class="va">par</span>, </span>
<span>                 outfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_aspm</span>, <span class="st">"ss.par"</span><span class="op">)</span>, </span>
<span>                 overwrite <span class="op">=</span> <span class="cn">T</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $headerlines</span></span>
<span><span class="co">## [1] "# Number of parameters = 32 Objective function value = 754.301687441726  Maximum gradient component = 8.77017492766611e-07"</span></span>
<span><span class="co">## [2] "# dummy_parm:"                                                                                                             </span></span>
<span><span class="co">## [3] "1.00000000000"                                                                                                             </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $MG_parms</span></span>
<span><span class="co">##                            INIT       ESTIM</span></span>
<span><span class="co">## NatM_p_1_Fem_GP_1    0.10000000  0.10000000</span></span>
<span><span class="co">## L_at_Amin_Fem_GP_1  22.76900000 22.76899194</span></span>
<span><span class="co">## L_at_Amax_Fem_GP_1  71.80720000 71.80721125</span></span>
<span><span class="co">## VonBert_K_Fem_GP_1   0.14216500  0.14216482</span></span>
<span><span class="co">## CV_young_Fem_GP_1    0.10000000  0.10000000</span></span>
<span><span class="co">## CV_old_Fem_GP_1      0.10000000  0.10000000</span></span>
<span><span class="co">## Wtlen_1_Fem_GP_1     0.00000244  0.00000244</span></span>
<span><span class="co">## Wtlen_2_Fem_GP_1     3.34694000  3.34694000</span></span>
<span><span class="co">## Mat50%_Fem_GP_1     55.00000000 55.00000000</span></span>
<span><span class="co">## Mat_slope_Fem_GP_1  -0.25000000 -0.25000000</span></span>
<span><span class="co">## Eggs_alpha_Fem_GP_1  1.00000000  1.00000000</span></span>
<span><span class="co">## Eggs_beta_Fem_GP_1   0.00000000  0.00000000</span></span>
<span><span class="co">## NatM_p_1_Mal_GP_1    0.00000000  0.00000000</span></span>
<span><span class="co">## L_at_Amin_Mal_GP_1   0.00000000  0.00000000</span></span>
<span><span class="co">## L_at_Amax_Mal_GP_1   0.00000000  0.00000000</span></span>
<span><span class="co">## VonBert_K_Mal_GP_1   0.00000000  0.00000000</span></span>
<span><span class="co">## CV_young_Mal_GP_1    0.00000000  0.00000000</span></span>
<span><span class="co">## CV_old_Mal_GP_1      0.00000000  0.00000000</span></span>
<span><span class="co">## Wtlen_1_Mal_GP_1     0.00000244  0.00000244</span></span>
<span><span class="co">## Wtlen_2_Mal_GP_1     3.34694000  3.34694000</span></span>
<span><span class="co">## CohortGrowDev        1.00000000  1.00000000</span></span>
<span><span class="co">## FracFemale_GP_1      0.50000000  0.50000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $SR_parms</span></span>
<span><span class="co">##               INIT    ESTIM</span></span>
<span><span class="co">## SR_LN(R0)   8.9274 8.927395</span></span>
<span><span class="co">## SR_BH_steep 0.8000 0.800000</span></span>
<span><span class="co">## SR_sigmaR   0.6000 0.600000</span></span>
<span><span class="co">## SR_regime   0.0000 0.000000</span></span>
<span><span class="co">## SR_autocorr 0.0000 0.000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $recdev1</span></span>
<span><span class="co">##       year recdev</span></span>
<span><span class="co">##  [1,] 2011      0</span></span>
<span><span class="co">##  [2,] 2012      0</span></span>
<span><span class="co">##  [3,] 2013      0</span></span>
<span><span class="co">##  [4,] 2014      0</span></span>
<span><span class="co">##  [5,] 2015      0</span></span>
<span><span class="co">##  [6,] 2016      0</span></span>
<span><span class="co">##  [7,] 2017      0</span></span>
<span><span class="co">##  [8,] 2018      0</span></span>
<span><span class="co">##  [9,] 2019      0</span></span>
<span><span class="co">## [10,] 2020      0</span></span>
<span><span class="co">## [11,] 2021      0</span></span>
<span><span class="co">## [12,] 2022      0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $recdev_forecast</span></span>
<span><span class="co">##       year recdev</span></span>
<span><span class="co">##  [1,] 2023      0</span></span>
<span><span class="co">##  [2,] 2024      0</span></span>
<span><span class="co">##  [3,] 2025      0</span></span>
<span><span class="co">##  [4,] 2026      0</span></span>
<span><span class="co">##  [5,] 2027      0</span></span>
<span><span class="co">##  [6,] 2028      0</span></span>
<span><span class="co">##  [7,] 2029      0</span></span>
<span><span class="co">##  [8,] 2030      0</span></span>
<span><span class="co">##  [9,] 2031      0</span></span>
<span><span class="co">## [10,] 2032      0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $init_F</span></span>
<span><span class="co">## [1] 0.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Q_parms</span></span>
<span><span class="co">##                           INIT      ESTIM</span></span>
<span><span class="co">## LnQ_base_SURVEY1(2)   0.476759  0.4767585</span></span>
<span><span class="co">## Q_extraSD_SURVEY1(2)  0.000000  0.0000000</span></span>
<span><span class="co">## LnQ_base_SURVEY2(3)  -6.304070 -6.3040672</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $S_parms</span></span>
<span><span class="co">##                            INIT     ESTIM</span></span>
<span><span class="co">## SizeSel_P_1_FISHERY(1) 56.51380 56.513807</span></span>
<span><span class="co">## SizeSel_P_2_FISHERY(1) 20.17930 20.179340</span></span>
<span><span class="co">## SizeSel_P_1_SURVEY1(2) 36.02330 36.023325</span></span>
<span><span class="co">## SizeSel_P_2_SURVEY1(2)  5.33502  5.335021</span></span>
<span><span class="co">## AgeSel_P_1_SURVEY2(3)   0.00000  0.000000</span></span>
<span><span class="co">## AgeSel_P_2_SURVEY2(3)   0.00000  0.000000</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="starter-file">Starter File<a class="anchor" aria-label="anchor" href="#starter-file"></a>
</h3>
<p>Change the starter file to read from <code>ss.par</code>
(<code>init_values_src = 1</code>) and to use the new data and control
files.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">starter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_readstarter.html" class="external-link">SS_readstarter</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_aspm</span>, <span class="st">"starter.ss"</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">starter</span><span class="op">$</span><span class="va">datfile</span> <span class="op">&lt;-</span> <span class="st">"data_echo.ss_new"</span></span>
<span><span class="va">starter</span><span class="op">$</span><span class="va">ctlfile</span> <span class="op">&lt;-</span> <span class="st">"control.ss_new"</span></span>
<span><span class="va">starter</span><span class="op">$</span><span class="va">init_values_src</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_writestarter.html" class="external-link">SS_writestarter</a></span><span class="op">(</span><span class="va">starter</span>, </span>
<span>                dir <span class="op">=</span> <span class="va">dir_aspm</span>, </span>
<span>                overwrite <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                verbose <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                warn <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: The `warn` argument of `SS_writestarter()` is deprecated as of r4ss 1.45.0.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="control-file">Control File<a class="anchor" aria-label="anchor" href="#control-file"></a>
</h3>
<p>Some things in the control file that may need to be changed, are
phases for parameters such as:</p>
<ul>
<li>length selectivity</li>
<li>age selectivity</li>
<li>size selectivity<br>
</li>
<li>steepness</li>
<li>sigmaR<br>
</li>
<li>recruitment deviations</li>
</ul>
<p>Additionally, the likelihood for some components may need to be
turned off as well. You can do this using the lambda options in the
control file. Some examples include:</p>
<ul>
<li>length-composition data<br>
</li>
<li>age-composition data</li>
<li>size-composition data<br>
</li>
<li>initial F</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_readctl_3.30.html" class="external-link">SS_readctl_3.30</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_aspm</span>, <span class="st">"control.ss_new"</span><span class="op">)</span>, </span>
<span>                           datlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_aspm</span>, <span class="st">"data_echo.ss_new"</span><span class="op">)</span>,</span>
<span>                           verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">control</span><span class="op">$</span><span class="va">SR_parms</span></span></code></pre></div>
<pre><code><span><span class="co">##               LO HI   INIT PRIOR PR_SD PR_type PHASE env_var&amp;link dev_link</span></span>
<span><span class="co">## SR_LN(R0)    6.0 12 8.9274  10.3  10.0       0     1            0        0</span></span>
<span><span class="co">## SR_BH_steep  0.2  1 0.8000   0.8   1.0       0    -4            0        0</span></span>
<span><span class="co">## SR_sigmaR    0.0  2 0.6000   0.8   0.8       0    -4            0        0</span></span>
<span><span class="co">## SR_regime   -5.0  5 0.0000   0.0   1.0       0    -4            0        0</span></span>
<span><span class="co">## SR_autocorr  0.0  0 0.0000   0.0   0.0       0   -99            0        0</span></span>
<span><span class="co">##             dev_minyr dev_maxyr dev_PH Block Block_Fxn</span></span>
<span><span class="co">## SR_LN(R0)           0         0      0     0         0</span></span>
<span><span class="co">## SR_BH_steep         0         0      0     0         0</span></span>
<span><span class="co">## SR_sigmaR           0         0      0     0         0</span></span>
<span><span class="co">## SR_regime           0         0      0     0         0</span></span>
<span><span class="co">## SR_autocorr         0         0      0     0         0</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Would need to run if PHASES were positive for "steep" and "sigmaR"</span></span>
<span><span class="co">#control$SR_parms[c(2,3),"PHASE"] &lt;- c(-4,-4)</span></span>
<span><span class="va">control</span><span class="op">$</span><span class="va">age_selex_parms</span></span></code></pre></div>
<pre><code><span><span class="co">##                       LO HI INIT PRIOR PR_SD PR_type PHASE env_var&amp;link</span></span>
<span><span class="co">## AgeSel_P_1_SURVEY2(3)  0 20    0     5    99       0   -99            0</span></span>
<span><span class="co">## AgeSel_P_2_SURVEY2(3)  0 20    0     6    99       0   -99            0</span></span>
<span><span class="co">##                       dev_link dev_minyr dev_maxyr dev_PH Block Block_Fxn</span></span>
<span><span class="co">## AgeSel_P_1_SURVEY2(3)        0         0         0      0     0         0</span></span>
<span><span class="co">## AgeSel_P_2_SURVEY2(3)        0         0         0      0     0         0</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#would need to run if PHASES were positive for age selectivity</span></span>
<span><span class="co">#control$age_selex_parms[,"PHASE"] &lt;- control$age_selex_parms[,"PHASE"] * -1</span></span>
<span><span class="va">control</span><span class="op">$</span><span class="va">size_selex_parms</span><span class="op">[</span>,<span class="st">"PHASE"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">control</span><span class="op">$</span><span class="va">size_selex_parms</span><span class="op">[</span>,<span class="st">"PHASE"</span><span class="op">]</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">control</span><span class="op">$</span><span class="va">recdev_early_phase</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">4</span></span>
<span><span class="va">control</span><span class="op">$</span><span class="va">recdev_phase</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> </span>
<span></span>
<span><span class="va">new_lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>like_comp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">7</span>,<span class="fl">9</span>,<span class="fl">9</span>,<span class="fl">9</span>,<span class="fl">10</span><span class="op">)</span>,</span>
<span>                          fleet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, </span>
<span>                          phase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                          value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                          sizefreq_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new_lambdas</span></span></code></pre></div>
<pre><code><span><span class="co">##    like_comp fleet phase value sizefreq_method</span></span>
<span><span class="co">## 1          4     1     1     0               1</span></span>
<span><span class="co">## 2          4     2     1     0               1</span></span>
<span><span class="co">## 3          5     1     1     0               1</span></span>
<span><span class="co">## 4          5     2     1     0               1</span></span>
<span><span class="co">## 5          7     1     1     0               1</span></span>
<span><span class="co">## 6          7     2     1     0               1</span></span>
<span><span class="co">## 7          9     1     1     0               1</span></span>
<span><span class="co">## 8          9     2     1     0               1</span></span>
<span><span class="co">## 9          9     3     1     0               1</span></span>
<span><span class="co">## 10        10     1     1     0               1</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span><span class="op">$</span><span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="va">new_lambdas</span></span>
<span><span class="va">control</span><span class="op">$</span><span class="va">N_lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">new_lambdas</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SS_writectl_3.30.html" class="external-link">SS_writectl_3.30</a></span><span class="op">(</span><span class="va">control</span>, outfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_aspm</span>, <span class="st">"control.ss_new"</span><span class="op">)</span>,</span>
<span>                 overwrite <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-aspm">Run ASPM<a class="anchor" aria-label="anchor" href="#run-aspm"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/run.html" class="external-link">run</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">dir_aspm</span>, exe <span class="op">=</span> <span class="st">"ss3"</span>, skipfinished <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "ran model"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="visualize-results">Visualize Results<a class="anchor" aria-label="anchor" href="#visualize-results"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SSgetoutput.html" class="external-link">SSgetoutput</a></span><span class="op">(</span>dirvec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="va">dir_tmp</span>,</span>
<span>  <span class="va">dir_aspm</span></span>
<span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mods_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SSsummarize.html" class="external-link">SSsummarize</a></span><span class="op">(</span><span class="va">mods</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r4ss.github.io/r4ss/reference/SSplotComparisons.html" class="external-link">SSplotComparisons</a></span><span class="op">(</span><span class="va">mods_sum</span>, legendlabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ref"</span>, <span class="st">"ASPM"</span><span class="op">)</span>,</span>
<span>                  subplots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">8</span>,<span class="fl">14</span><span class="op">)</span>, new <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## showing uncertainty for all models</span></span></code></pre>
<pre><code><span><span class="co">## subplot 2: spawning biomass with uncertainty intervals</span></span></code></pre>
<pre><code><span><span class="co">## subplot 8: F value with uncertainty</span></span></code></pre>
<p><img src="aspm_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<pre><code><span><span class="co">## subplot 14: index fits on a log scale</span></span></code></pre>
<p><img src="aspm_files/figure-html/unnamed-chunk-9-2.png" width="700"><img src="aspm_files/figure-html/unnamed-chunk-9-3.png" width="700"><img src="aspm_files/figure-html/unnamed-chunk-9-4.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Henning Winker, Felipe Carvalho, Massimiliano Cardinale, Laurence Kell, Megumi Oshima, Eric Fletcher.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
